Bootstrap: docker
From: feelpp/feelpp-toolboxes:latest

%setup
    echo "Looking in directory '$SINGULARITY_ROOTFS' for /bin/sh"
    if [ ! -x "$SINGULARITY_ROOTFS/bin/sh" ]; then
        echo "Hrmm, this container does not have /bin/sh installed..."
        exit 1
    fi

    cp singularity.d/env/99-feelenv.sh $SINGULARITY_ROOTFS/.singularity.d/env/

    exit 0

%post
    echo "Post install"
    sed -i 's/.*PS1 *=.*//g' /etc/bash.bashrc
    sed -i 's/.*PS1 *=.*//g' /.singularity.d/actions/shell
    sed -i 's/.*PS1 *=.*//g' /.singularity.d/env/99-base.sh
    sed -i 's/.*HOME *=.*//g' /.singularity.d/env/10-docker.sh
    mkdir /feel
    mv /home/feelpp /opt/feelpp
    
    # Clean temporary files. 
    rm -rf `find /opt/feelpp -name ".*" ! -path .`

    echo "alias ls='ls --color=auto'" >> /etc/bash.bashrc
    echo "alias ll='ls -ls'" >> /etc/bash.bashrc
    echo "alias grep='grep --color'" >> /etc/bash.bashrc

    exit 0

%runscript
    echo "Arguments received: $*"
    exec /usr/bin/python "$@"
